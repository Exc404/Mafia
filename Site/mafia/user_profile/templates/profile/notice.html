{% extends 'profile_base.html' %}
 
{% block title %}–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è{% endblock %}
{% block style %}
{% endblock%}

{% block script %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function() {
  $('.delete-button').click(function() {
    var recordId = $(this).data('record-id');

    $.ajax({
      url: 'delete_record/' + recordId + '/',
      method: 'POST',
      success: function(response) {
        var elementToRemove = document.querySelector('[data-record-id="' + response.notice_id + 'notice"]');
            if (elementToRemove) {
                elementToRemove.remove();
            }
      },
      error: function(xhr, status, error) {
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏
        console.log(error);
      }
    });
  });
});

$(document).ready(function() {
  $('.add-button').click(function() {
    var recordId = $(this).data('record-id');

    $.ajax({
      url: 'add_record/' + recordId + '/',
      method: 'POST',
      success: function(response) {
        var elementToRemove = document.querySelector('[data-record-id="' + response.notice_id + 'notice"]');
            if (elementToRemove) {
                elementToRemove.remove();
            }
      },
      error: function(xhr, status, error) {
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏
        console.log(error);
      }
    });
  });
});
</script>
{% endblock%}

{% block content %}
<div id="head">
	<a class="ExitButton" href="{% url 'mainpage'%}">ü°∏</a>
	<h1 style="margin-top: 1em;">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h1>
</div>
<div class="content">
	<table>
    {% if notices %}
		{% for notice in notices %}
            <tr data-record-id="{{ notice.id }}notice">
            {% if notice.notice_type == 'FR' %}
                <td>
                    <p><a href="{{ notice.sender.profile.get_absolute_url }}">{{ notice.sender.profile.nickname }}</a> —Ö–æ—á–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –≤–∞—Å –≤ –¥—Ä—É–∑—å—è!</p>
                </td>
                <td>
                    <button class="add-button" data-record-id="{{ notice.id }}">–î–æ–±–∞–≤–∏—Ç—å</button>
                </td>
            {% endif %}
            {% if notice.notice_type == 'IV' %}
                <td>
                    <p><a href="{{ notice.sender.profile.get_absolute_url }}">{{ notice.sender.profile.nickname }}</a> –ø—Ä–∏–≥–ª–∞—à–∞–µ—Ç –≤–∞—Å –≤ –∏–≥—Ä—É!</p>
                </td>
                <td></td>
            {% endif %}
            {% if notice.notice_type == 'IF' %}
                <td>
                    <p>–°–µ—Ä–≤–µ—Ä: {{ notice.text_message }}</p>
                </td>
                <td></td>
            {% endif %}
                <td>
                    <button class="delete-button" data-record-id="{{ notice.id }}">–£–¥–∞–ª–∏—Ç—å</button>
                </td>
		    </tr>
        {% endfor %}
    {% else %}
        <tr>–£ –≤–∞—Å –Ω–µ—Ç –Ω–æ–≤—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</tr>
    {% endif %}
    </table>
</div>
{% endblock content%}