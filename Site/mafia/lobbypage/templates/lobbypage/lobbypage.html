<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
    </head>
    <body>
        <h1>Тестовый билд №3,14</h1>
        <form id = "messageInputForm">
            <input type = "text" name = "messageForm"/>
        </form>
        <div id = "messages"></div>
        <script type = "text/javascript">
            let urlTemp = window.location.host
            let url = 'ws://' + urlTemp + '/ws/socket-server/'
            const testSocket = new WebSocket(url)
            testSocket.onmessage = function(e){
                let data = JSON.parse(e.data)
                console.log('Data: ', data)
                if(data.type === 'chat'){
                    let messages = document.getElementById('messages')
                    let htmlAdding = '<div><p>' + data.message + '</p></div>'
                    messages.insertAdjacentHTML('beforeend', htmlAdding)
                }
            }
            let inputForm = document.getElementById('messageInputForm')
            inputForm.addEventListener('submit', (e) => {
                e.preventDefault()
                let message = e.target.messageForm.value
                testSocket.send(JSON.stringify({
                    'message' : message
                }))
                inputForm.reset()
            })
        </script>
    </body>
</html>